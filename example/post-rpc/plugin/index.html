<html>
  <head>
    <meta charset="UTF-8">
  </head>
  <body style="background: #fefefe;">
    <h1>PostRPC Plugin</h1>
    <div id="content">
    </div>
 	<script type="text/javascript" src="../../PostRPC.Client.js"></script>
    <script type="text/javascript">
      // PostRPC Plugin iFrame
      //

		var display = function (request, result, error) {
			console.log('Plugin: request: ', request, 'result: ', result, 'error: ', error);
			var content = document.getElementById('content');
			var output = '';
			output = output + '<div>Request: '+JSON.stringify(request)+'</div><br>';
			output = output + '<div>Result: '+JSON.stringify(result)+'</div><br>';
			output = output + '<div>Error: '+JSON.stringify(error)+'</div><br>';
			content.innerHTML = content.innerHTML+'<div>'+output+'</div><br>';
		}

		document.addEventListener("DOMContentLoaded", function(event) {

			console.log("Plugin: DOM loaded and parsed");

			var client = new window.PostRPC.Client('http://localhost:5001');
			client.logging(false);
			client.start();

			client.subscribe('changed', function(result, error) {
				display(null, result, error);
			});

			client.call(null, null, function(result, error) {
				display(client.request(null, null, 1), result, error);
			});

			client.call('subtract', {a: 11}, function(result, error) {
				display(client.request('subtract', {a: 11}, 2), result, error);
			});

			client.call('subtract', {a: 11, b: -8}, function(result, error) {
				display(client.request('subtract', {a: 11, b: -8}, 3), result, error);
			});

			client.call('divide', {a: 2, b: 0}, function(result, error) {
				display(client.request('divide', {a: 2, b: 0}, 4), result, error);
			});

			client.call('digits', {num: 1, n: 500}, function(result, error) {
				display(client.request('digits', {num: 1, n: 500}, 5), result, error);
			});

			client.call('complex', {id: 101}, function(result, error) {
				display(client.request('complex', {id: 101}, 6), result, error);
			});

			client.call('add', {a: 2, b: 2})
			.then(function(result) {
				display(client.request('add', {a: 2, b: 2}, 7), result, null);
		    })
			.catch(function(error) {
				display(client.request('add', {a: 2, b: 2}, 8), null, error);
		    });

			client.call('getForms', {workspaceID: 11}, function(result, error) {
				display(client.request('getForms', {workspaceID: 11}, 9), result, error);
			});

			client.call('getRecords', {formID: 101}, function(result, error) {
				display(client.request('getRecords', {formID: 101}, 10), result, error);
			});

		});

    </script>
  </body>
</html>
